import{_ as a,c as i,o as t,ag as n}from"./chunks/framework.dvv-DFtf.js";const c=JSON.parse('{"title":"Self-Improving AI System","description":"","frontmatter":{},"headers":[],"relativePath":"self-improving/README.md","filePath":"self-improving/README.md"}'),e={name:"self-improving/README.md"};function l(p,s,o,d,r,h){return t(),i("div",null,[...s[0]||(s[0]=[n(`<h1 id="self-improving-ai-system" tabindex="-1">Self-Improving AI System <a class="header-anchor" href="#self-improving-ai-system" aria-label="Permalink to &quot;Self-Improving AI System&quot;">​</a></h1><p><strong>Sistema de Auto-Melhoria de Agentes de IA</strong><strong>Versao:</strong> v1.0 <strong>Ultima Atualizacao:</strong> 2025-12-27 <strong>Baseado em:</strong> Self_Improving_System_Starter_Kit + AI Factory V4</p><hr><h2 id="indice" tabindex="-1">Indice <a class="header-anchor" href="#indice" aria-label="Permalink to &quot;Indice&quot;">​</a></h2><ol><li><a href="#1-visao-geral-do-sistema">Visao Geral do Sistema</a></li><li><a href="#2-arquitetura">Arquitetura</a></li><li><a href="#3-componentes-principais">Componentes Principais</a></li><li><a href="#4-fluxo-de-funcionamento">Fluxo de Funcionamento</a></li><li><a href="#5-configuracoes-disponiveis">Configuracoes Disponiveis</a></li><li><a href="#6-decision-framework">Decision Framework</a></li><li><a href="#7-rubrica-de-avaliacao">Rubrica de Avaliacao</a></li><li><a href="#8-integracao-com-n8n">Integracao com n8n</a></li><li><a href="#9-seguranca-e-guardrails">Seguranca e Guardrails</a></li><li><a href="#10-troubleshooting">Troubleshooting</a></li></ol><hr><h2 id="_1-visao-geral-do-sistema" tabindex="-1">1. Visao Geral do Sistema <a class="header-anchor" href="#_1-visao-geral-do-sistema" aria-label="Permalink to &quot;1. Visao Geral do Sistema&quot;">​</a></h2><p>O <strong>Self-Improving AI System</strong> e um sistema autonomo de auto-melhoria para agentes de IA conversacionais. Ele utiliza a tecnica <strong>LLM-as-Judge</strong> (IA avaliando IA) para:</p><ul><li><strong>Monitorar</strong> a performance de agentes em producao</li><li><strong>Avaliar</strong> conversas usando uma rubrica de 5 criterios</li><li><strong>Gerar sugestoes</strong> de melhoria de prompts automaticamente</li><li><strong>Aplicar mudancas</strong> de forma segura com rollback automatico</li><li><strong>Versionar</strong> prompts com historico completo</li></ul><h3 id="problema-que-resolve" tabindex="-1">Problema que Resolve <a class="header-anchor" href="#problema-que-resolve" aria-label="Permalink to &quot;Problema que Resolve&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Antes</th><th>Depois</th></tr></thead><tbody><tr><td>Testes manuais demorados</td><td>Avaliacao automatica continua</td></tr><tr><td>Impossivel saber se agente esta bom</td><td>Scores objetivos de 0-5 em 5 dimensoes</td></tr><tr><td>Sem escalabilidade</td><td>Processa centenas de conversas/dia</td></tr><tr><td>Melhorias dependem de humano</td><td>Auto-melhoria com supervisao</td></tr></tbody></table><h3 id="conceito-central-reflection-loop" tabindex="-1">Conceito Central: Reflection Loop <a class="header-anchor" href="#conceito-central-reflection-loop" aria-label="Permalink to &quot;Conceito Central: Reflection Loop&quot;">​</a></h3><p>O sistema implementa um <strong>ciclo de reflexao</strong> onde:</p><ol><li>Agente executa conversas normalmente</li><li>Periodicamente, um <strong>Evaluator LLM</strong> (Claude Sonnet) analisa as conversas</li><li>Baseado nos scores, o sistema decide se deve: <ul><li>Fazer nada (score alto)</li><li>Gerar sugestao de melhoria</li><li>Aplicar melhoria automaticamente</li><li>Escalar para humano (score muito baixo)</li></ul></li></ol><hr><h2 id="_2-arquitetura" tabindex="-1">2. Arquitetura <a class="header-anchor" href="#_2-arquitetura" aria-label="Permalink to &quot;2. Arquitetura&quot;">​</a></h2><h3 id="diagrama-de-arquitetura-completa" tabindex="-1">Diagrama de Arquitetura Completa <a class="header-anchor" href="#diagrama-de-arquitetura-completa" aria-label="Permalink to &quot;Diagrama de Arquitetura Completa&quot;">​</a></h3><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flowchart TB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph PRODUCAO[&quot;CAMADA DE PRODUCAO&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        GHL[(&quot;GHL&lt;br/&gt;WhatsApp&quot;)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        EXEC[&quot;05-AI-Agent-Execution&lt;br/&gt;(Agente Ativo)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        GHL --&gt;|&quot;Webhook mensagem&quot;| EXEC</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        EXEC --&gt;|&quot;Resposta&quot;| GHL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        EXEC --&gt;|&quot;Salva mensagens&quot;| CONV[(&quot;agent_conversations&lt;br/&gt;+ messages&quot;)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph REFLECTION[&quot;CAMADA DE REFLEXAO&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        TRIGGER[&quot;Schedule Trigger&lt;br/&gt;(a cada 6h)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        FETCH[&quot;Buscar Conversas&lt;br/&gt;Periodo: 6h&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        EVAL[&quot;Claude Sonnet&lt;br/&gt;AI-as-Judge&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        DECIDE[&quot;Decision Framework&quot;]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        TRIGGER --&gt; FETCH</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        FETCH --&gt; EVAL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        EVAL --&gt; DECIDE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph STORAGE[&quot;CAMADA DE DADOS&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        SP[(&quot;system_prompts&lt;br/&gt;Versionamento&quot;)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        RL[(&quot;reflection_logs&lt;br/&gt;Historico&quot;)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        IS[(&quot;improvement_suggestions&lt;br/&gt;Sugestoes&quot;)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        SS[(&quot;self_improving_settings&lt;br/&gt;Configuracoes&quot;)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph ACTIONS[&quot;ACOES POSSIVEIS&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        NONE[&quot;NONE&lt;br/&gt;(Score &gt;= 4.0)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        SUGGEST[&quot;SUGESTAO&lt;br/&gt;(Score 3.0-3.9)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        AUTO[&quot;AUTO-UPDATE&lt;br/&gt;(Score 2.0-2.9)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ESCALATE[&quot;ESCALATE&lt;br/&gt;(Score &lt; 2.0)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CONV --&gt; FETCH</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SP --&gt; EXEC</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DECIDE --&gt; NONE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DECIDE --&gt; SUGGEST</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DECIDE --&gt; AUTO</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DECIDE --&gt; ESCALATE</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SUGGEST --&gt;|&quot;Cria&quot;| IS</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AUTO --&gt;|&quot;Aplica + Cria&quot;| SP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ESCALATE --&gt;|&quot;Notifica&quot;| NOTIFY[&quot;WhatsApp/Slack&quot;]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    EVAL --&gt;|&quot;Log&quot;| RL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SS --&gt;|&quot;Configura&quot;| DECIDE</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style PRODUCAO fill:#e1f5fe</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style REFLECTION fill:#fff3e0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style STORAGE fill:#f3e5f5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style ACTIONS fill:#e8f5e9</span></span></code></pre></div><h3 id="diagrama-do-ciclo-de-vida-do-prompt" tabindex="-1">Diagrama do Ciclo de Vida do Prompt <a class="header-anchor" href="#diagrama-do-ciclo-de-vida-do-prompt" aria-label="Permalink to &quot;Diagrama do Ciclo de Vida do Prompt&quot;">​</a></h3><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">stateDiagram-v2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [*] --&gt; Initial: Criado pela Call Analyzer</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Initial --&gt; Active: Aprovado pelo Validator</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Active --&gt; Active: Score &gt;= 4.0 (Mantido)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Active --&gt; PendingSuggestion: Score 3.0-3.9</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PendingSuggestion --&gt; NewVersion: Humano Aprova</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PendingSuggestion --&gt; Active: Humano Rejeita</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Active --&gt; AutoUpdated: Score 2.0-2.9 + Alta Confianca</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AutoUpdated --&gt; Active: Score Melhorou</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AutoUpdated --&gt; RolledBack: Score Piorou &gt; 0.5</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    RolledBack --&gt; Active: Volta versao anterior</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Active --&gt; Escalated: Score &lt; 2.0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Escalated --&gt; Active: Humano Intervem</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    NewVersion --&gt; Active: Ativado</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    note right of Active</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Prompt em uso</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pelo agente</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end note</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    note right of AutoUpdated</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Periodo de observacao</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        (24h minimo)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end note</span></span></code></pre></div><h3 id="diagrama-de-sequencia-ciclo-de-reflexao" tabindex="-1">Diagrama de Sequencia: Ciclo de Reflexao <a class="header-anchor" href="#diagrama-de-sequencia-ciclo-de-reflexao" aria-label="Permalink to &quot;Diagrama de Sequencia: Ciclo de Reflexao&quot;">​</a></h3><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sequenceDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant Cron as Schedule Trigger</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant N8N as n8n Workflow</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant DB as Supabase</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant LLM as Claude Sonnet</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant Notify as Notificacao</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Cron-&gt;&gt;N8N: Dispara a cada 6h</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    N8N-&gt;&gt;DB: can_run_reflection(agent_id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DB--&gt;&gt;N8N: {can_run: true, config: {...}}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    N8N-&gt;&gt;DB: Buscar conversas periodo</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DB--&gt;&gt;N8N: Lista de conversas + mensagens</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    N8N-&gt;&gt;LLM: Avaliar conversas (Rubrica 5 criterios)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    LLM--&gt;&gt;N8N: Scores + Feedback + Patterns</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    alt Score &gt;= 4.0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        N8N-&gt;&gt;DB: Log: action_taken = &#39;none&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        N8N--&gt;&gt;Cron: Fim (sem acao)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    else Score 3.0-3.9</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        N8N-&gt;&gt;LLM: Gerar sugestao de melhoria</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        LLM--&gt;&gt;N8N: Novo prompt sugerido</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        N8N-&gt;&gt;DB: Criar improvement_suggestion</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        N8N-&gt;&gt;Notify: Notificar CS</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    else Score 2.0-2.9 + Confianca &gt;= 0.85</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        N8N-&gt;&gt;LLM: Gerar melhoria</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        LLM--&gt;&gt;N8N: Novo prompt</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        N8N-&gt;&gt;DB: Criar system_prompt (versao N+1)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        N8N-&gt;&gt;DB: Ativar novo prompt</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        N8N-&gt;&gt;Notify: Notificar auto-update</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    else Score &lt; 2.0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        N8N-&gt;&gt;DB: Log: action_taken = &#39;escalate&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        N8N-&gt;&gt;Notify: ALERTA URGENTE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span></code></pre></div><hr><h2 id="_3-componentes-principais" tabindex="-1">3. Componentes Principais <a class="header-anchor" href="#_3-componentes-principais" aria-label="Permalink to &quot;3. Componentes Principais&quot;">​</a></h2><h3 id="_3-1-tabelas-do-banco-de-dados" tabindex="-1">3.1 Tabelas do Banco de Dados <a class="header-anchor" href="#_3-1-tabelas-do-banco-de-dados" aria-label="Permalink to &quot;3.1 Tabelas do Banco de Dados&quot;">​</a></h3><p>O sistema utiliza 4 tabelas principais no Supabase:</p><h4 id="system-prompts-versionamento-de-prompts" tabindex="-1">system_prompts - Versionamento de Prompts <a class="header-anchor" href="#system-prompts-versionamento-de-prompts" aria-label="Permalink to &quot;system_prompts - Versionamento de Prompts&quot;">​</a></h4><p>Armazena todas as versoes de prompts com historico completo.</p><table tabindex="0"><thead><tr><th>Campo</th><th>Tipo</th><th>Descricao</th></tr></thead><tbody><tr><td>id</td><td>UUID</td><td>Identificador unico</td></tr><tr><td>agent_version_id</td><td>UUID</td><td>FK para agent_versions</td></tr><tr><td>version</td><td>INTEGER</td><td>Numero da versao (1, 2, 3...)</td></tr><tr><td>parent_id</td><td>UUID</td><td>Referencia ao prompt anterior</td></tr><tr><td>is_active</td><td>BOOLEAN</td><td>Se e o prompt ativo</td></tr><tr><td>prompt_content</td><td>TEXT</td><td>Conteudo do prompt</td></tr><tr><td>model_config</td><td>JSONB</td><td>Configuracoes do modelo (temperature, tools)</td></tr><tr><td>performance_score</td><td>DECIMAL(3,2)</td><td>Score medio (0.00-5.00)</td></tr><tr><td>change_reason</td><td>TEXT</td><td>Trigger: auto_improvement, manual_edit, rollback</td></tr><tr><td>activated_at</td><td>TIMESTAMPTZ</td><td>Quando foi ativado</td></tr></tbody></table><p><strong>Indices importantes:</strong></p><ul><li>idx_system_prompts_active: Busca rapida do prompt ativo</li><li>idx_system_prompts_performance: Ordenacao por performance</li></ul><h4 id="reflection-logs-logs-de-reflexao" tabindex="-1">reflection_logs - Logs de Reflexao <a class="header-anchor" href="#reflection-logs-logs-de-reflexao" aria-label="Permalink to &quot;reflection_logs - Logs de Reflexao&quot;">​</a></h4><p>Registra cada ciclo de avaliacao executado.</p><table tabindex="0"><thead><tr><th>Campo</th><th>Tipo</th><th>Descricao</th></tr></thead><tbody><tr><td>id</td><td>UUID</td><td>Identificador unico</td></tr><tr><td>agent_version_id</td><td>UUID</td><td>Agente avaliado</td></tr><tr><td>period_start</td><td>TIMESTAMPTZ</td><td>Inicio do periodo analisado</td></tr><tr><td>period_end</td><td>TIMESTAMPTZ</td><td>Fim do periodo</td></tr><tr><td>conversations_analyzed</td><td>INTEGER</td><td>Quantidade de conversas</td></tr><tr><td>score_completeness</td><td>DECIMAL(3,2)</td><td>Completude (peso 20%)</td></tr><tr><td>score_depth</td><td>DECIMAL(3,2)</td><td>Profundidade (peso 25%)</td></tr><tr><td>score_tone</td><td>DECIMAL(3,2)</td><td>Tom/Personalidade (peso 15%)</td></tr><tr><td>score_scope</td><td>DECIMAL(3,2)</td><td>Escopo/Relevancia (peso 20%)</td></tr><tr><td>score_missed_opportunities</td><td>DECIMAL(3,2)</td><td>Oportunidades Perdidas (peso 20%)</td></tr><tr><td>overall_score</td><td>DECIMAL(3,2)</td><td>Score agregado (media ponderada)</td></tr><tr><td>strengths</td><td>TEXT[]</td><td>Pontos fortes identificados</td></tr><tr><td>weaknesses</td><td>TEXT[]</td><td>Pontos fracos identificados</td></tr><tr><td>patterns_identified</td><td>TEXT[]</td><td>Padroes detectados</td></tr><tr><td>action_taken</td><td>VARCHAR(50)</td><td>Decisao: none, suggestion, auto_update, escalate</td></tr><tr><td>cooldown_respected</td><td>BOOLEAN</td><td>Se respeitou periodo minimo</td></tr></tbody></table><h4 id="improvement-suggestions-sugestoes-de-melhoria" tabindex="-1">improvement_suggestions - Sugestoes de Melhoria <a class="header-anchor" href="#improvement-suggestions-sugestoes-de-melhoria" aria-label="Permalink to &quot;improvement_suggestions - Sugestoes de Melhoria&quot;">​</a></h4><p>Armazena sugestoes geradas pelo sistema, pendentes de aprovacao.</p><table tabindex="0"><thead><tr><th>Campo</th><th>Tipo</th><th>Descricao</th></tr></thead><tbody><tr><td>id</td><td>UUID</td><td>Identificador unico</td></tr><tr><td>agent_version_id</td><td>UUID</td><td>Agente alvo</td></tr><tr><td>reflection_log_id</td><td>UUID</td><td>Reflexao que gerou</td></tr><tr><td>suggestion_type</td><td>VARCHAR(50)</td><td>prompt_update, config_change, escalation</td></tr><tr><td>current_value</td><td>TEXT</td><td>Prompt atual</td></tr><tr><td>suggested_value</td><td>TEXT</td><td>Prompt sugerido</td></tr><tr><td>diff_summary</td><td>TEXT</td><td>Resumo das diferencas</td></tr><tr><td>rationale</td><td>TEXT</td><td>Justificativa da IA</td></tr><tr><td>confidence_score</td><td>DECIMAL(3,2)</td><td>Confianca (0.00-1.00)</td></tr><tr><td>focus_areas</td><td>TEXT[]</td><td>Areas de foco: tone, completeness, etc</td></tr><tr><td>status</td><td>VARCHAR(50)</td><td>pending, approved, rejected, auto_applied, rolled_back</td></tr><tr><td>post_apply_score</td><td>DECIMAL(3,2)</td><td>Score apos aplicar</td></tr><tr><td>improvement_delta</td><td>DECIMAL(3,2)</td><td>Diferenca de score</td></tr></tbody></table><h4 id="self-improving-settings-configuracoes" tabindex="-1">self_improving_settings - Configuracoes <a class="header-anchor" href="#self-improving-settings-configuracoes" aria-label="Permalink to &quot;self_improving_settings - Configuracoes&quot;">​</a></h4><p>Configuracoes do sistema por agente.</p><table tabindex="0"><thead><tr><th>Campo</th><th>Tipo</th><th>Default</th><th>Descricao</th></tr></thead><tbody><tr><td>reflection_enabled</td><td>BOOLEAN</td><td>true</td><td>Sistema ativo</td></tr><tr><td>reflection_interval_hours</td><td>INTEGER</td><td>6</td><td>Horas entre reflexoes</td></tr><tr><td>min_conversations_for_reflection</td><td>INTEGER</td><td>10</td><td>Minimo de conversas</td></tr><tr><td>threshold_none</td><td>DECIMAL</td><td>4.0</td><td>Score para nenhuma acao</td></tr><tr><td>threshold_suggestion</td><td>DECIMAL</td><td>3.0</td><td>Score para sugestao</td></tr><tr><td>threshold_auto_update</td><td>DECIMAL</td><td>2.0</td><td>Score para auto-update</td></tr><tr><td>max_updates_per_day</td><td>INTEGER</td><td>3</td><td>Limite de updates/dia</td></tr><tr><td>auto_apply_enabled</td><td>BOOLEAN</td><td>false</td><td>Permite auto-update</td></tr><tr><td>auto_apply_min_confidence</td><td>DECIMAL</td><td>0.85</td><td>Confianca minima</td></tr><tr><td>auto_apply_max_score_drop</td><td>DECIMAL</td><td>0.5</td><td>Rollback se cair mais</td></tr><tr><td>evaluator_model</td><td>VARCHAR</td><td>claude-sonnet-4-20250514</td><td>Modelo avaliador</td></tr></tbody></table><h3 id="_3-2-views-para-dashboard" tabindex="-1">3.2 Views para Dashboard <a class="header-anchor" href="#_3-2-views-para-dashboard" aria-label="Permalink to &quot;3.2 Views para Dashboard&quot;">​</a></h3><h4 id="vw-self-improving-summary" tabindex="-1">vw_self_improving_summary <a class="header-anchor" href="#vw-self-improving-summary" aria-label="Permalink to &quot;vw_self_improving_summary&quot;">​</a></h4><p>Resumo de status do sistema por agente.</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vw_self_improving_summary;</span></span></code></pre></div><p>Retorna:</p><ul><li>Prompt ativo e versao</li><li>Score atual</li><li>Ultima reflexao e acao tomada</li><li>Sugestoes pendentes</li><li>Contadores das ultimas 24h</li></ul><h4 id="vw-score-evolution" tabindex="-1">vw_score_evolution <a class="header-anchor" href="#vw-score-evolution" aria-label="Permalink to &quot;vw_score_evolution&quot;">​</a></h4><p>Evolucao de scores ao longo do tempo.</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vw_score_evolution </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> agent_version_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;uuid&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>Retorna:</p><ul><li>Score medio por dia</li><li>Breakdown por criterio</li><li>Quantidade de auto-updates e escalacoes</li></ul><h4 id="vw-pending-suggestions" tabindex="-1">vw_pending_suggestions <a class="header-anchor" href="#vw-pending-suggestions" aria-label="Permalink to &quot;vw_pending_suggestions&quot;">​</a></h4><p>Sugestoes aguardando aprovacao.</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vw_pending_suggestions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ORDER BY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> confidence_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DESC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h3 id="_3-3-rpc-functions" tabindex="-1">3.3 RPC Functions <a class="header-anchor" href="#_3-3-rpc-functions" aria-label="Permalink to &quot;3.3 RPC Functions&quot;">​</a></h3><h4 id="get-self-improving-config-agent-id" tabindex="-1">get_self_improving_config(agent_id) <a class="header-anchor" href="#get-self-improving-config-agent-id" aria-label="Permalink to &quot;get_self_improving_config(agent_id)&quot;">​</a></h4><p>Retorna configuracoes do agente com valores padrao se nao existir.</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_self_improving_config(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;agent-uuid-here&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h4 id="can-run-reflection-agent-id" tabindex="-1">can_run_reflection(agent_id) <a class="header-anchor" href="#can-run-reflection-agent-id" aria-label="Permalink to &quot;can_run_reflection(agent_id)&quot;">​</a></h4><p>Verifica se pode executar reflexao (cooldown, limites).</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> can_run_reflection(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;agent-uuid-here&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>Retorna:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;can_run&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;reason&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;OK&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;hours_since_last&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;updates_today&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;config&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="_4-fluxo-de-funcionamento" tabindex="-1">4. Fluxo de Funcionamento <a class="header-anchor" href="#_4-fluxo-de-funcionamento" aria-label="Permalink to &quot;4. Fluxo de Funcionamento&quot;">​</a></h2><h3 id="_4-1-fluxo-completo-passo-a-passo" tabindex="-1">4.1 Fluxo Completo Passo a Passo <a class="header-anchor" href="#_4-1-fluxo-completo-passo-a-passo" aria-label="Permalink to &quot;4.1 Fluxo Completo Passo a Passo&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>PASSO 1: COLETA DE DADOS</span></span>
<span class="line"><span>========================</span></span>
<span class="line"><span>- Agente executa conversas normalmente (05-AI-Agent-Execution)</span></span>
<span class="line"><span>- Cada mensagem e salva em agent_conversations + messages</span></span>
<span class="line"><span>- Sistema aguarda periodo minimo (6h default)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>PASSO 2: TRIGGER DE REFLEXAO</span></span>
<span class="line"><span>============================</span></span>
<span class="line"><span>- Schedule trigger dispara (a cada 6h)</span></span>
<span class="line"><span>- Verifica: can_run_reflection(agent_id)</span></span>
<span class="line"><span>  - Cooldown respeitado?</span></span>
<span class="line"><span>  - Limite diario OK?</span></span>
<span class="line"><span>  - Minimo de conversas?</span></span>
<span class="line"><span></span></span>
<span class="line"><span>PASSO 3: COLETA DE CONVERSAS</span></span>
<span class="line"><span>============================</span></span>
<span class="line"><span>- Busca conversas do periodo (period_start, period_end)</span></span>
<span class="line"><span>- Filtra apenas conversas finalizadas</span></span>
<span class="line"><span>- Formata para analise</span></span>
<span class="line"><span></span></span>
<span class="line"><span>PASSO 4: AVALIACAO (LLM-as-Judge)</span></span>
<span class="line"><span>=================================</span></span>
<span class="line"><span>- Envia conversas para Claude Sonnet</span></span>
<span class="line"><span>- Prompt de avaliacao com rubrica de 5 criterios</span></span>
<span class="line"><span>- Recebe: scores, feedback, patterns, strengths, weaknesses</span></span>
<span class="line"><span></span></span>
<span class="line"><span>PASSO 5: DECISION FRAMEWORK</span></span>
<span class="line"><span>===========================</span></span>
<span class="line"><span>- Calcula overall_score (media ponderada)</span></span>
<span class="line"><span>- Aplica thresholds:</span></span>
<span class="line"><span>  - &gt;= 4.0: NONE</span></span>
<span class="line"><span>  - 3.0-3.9: SUGGESTION</span></span>
<span class="line"><span>  - 2.0-2.9: AUTO_UPDATE (se enabled e confianca alta)</span></span>
<span class="line"><span>  - &lt; 2.0: ESCALATE</span></span>
<span class="line"><span></span></span>
<span class="line"><span>PASSO 6: EXECUCAO DA ACAO</span></span>
<span class="line"><span>=========================</span></span>
<span class="line"><span>[Se NONE]</span></span>
<span class="line"><span>- Apenas loga a reflexao</span></span>
<span class="line"><span>- Nenhuma mudanca</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Se SUGGESTION]</span></span>
<span class="line"><span>- Gera novo prompt sugerido via LLM</span></span>
<span class="line"><span>- Cria improvement_suggestion com status &#39;pending&#39;</span></span>
<span class="line"><span>- Notifica CS para revisao</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Se AUTO_UPDATE]</span></span>
<span class="line"><span>- Gera novo prompt via LLM</span></span>
<span class="line"><span>- Cria system_prompt versao N+1</span></span>
<span class="line"><span>- Ativa novo prompt</span></span>
<span class="line"><span>- Inicia periodo de observacao (24h)</span></span>
<span class="line"><span>- Notifica sobre mudanca</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Se ESCALATE]</span></span>
<span class="line"><span>- Loga como critico</span></span>
<span class="line"><span>- Envia alerta urgente</span></span>
<span class="line"><span>- Bloqueia auto-updates temporariamente</span></span>
<span class="line"><span></span></span>
<span class="line"><span>PASSO 7: MONITORAMENTO POS-ACAO</span></span>
<span class="line"><span>===============================</span></span>
<span class="line"><span>[Para AUTO_UPDATE]</span></span>
<span class="line"><span>- Apos 24h, avalia novo score</span></span>
<span class="line"><span>- Se piorou &gt; max_score_drop: ROLLBACK</span></span>
<span class="line"><span>- Se melhorou: confirma mudanca</span></span></code></pre></div><h3 id="_4-2-exemplo-pratico" tabindex="-1">4.2 Exemplo Pratico <a class="header-anchor" href="#_4-2-exemplo-pratico" aria-label="Permalink to &quot;4.2 Exemplo Pratico&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Cenario: Agente Isabella SDR com score caindo</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Dia 1, 18:00 - Reflexao #1</span></span>
<span class="line"><span>- Conversas: 25</span></span>
<span class="line"><span>- Score: 4.2 (EXCELENTE)</span></span>
<span class="line"><span>- Acao: NONE</span></span>
<span class="line"><span>- Status: Tudo OK</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Dia 2, 00:00 - Reflexao #2</span></span>
<span class="line"><span>- Conversas: 18</span></span>
<span class="line"><span>- Score: 3.7 (BOM)</span></span>
<span class="line"><span>- Acao: SUGGESTION</span></span>
<span class="line"><span>- Criado: improvement_suggestion com foco em &#39;tone&#39;</span></span>
<span class="line"><span>- Notificado: CS recebe mensagem WhatsApp</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Dia 2, 10:00 - CS aprova sugestao</span></span>
<span class="line"><span>- Status: approved</span></span>
<span class="line"><span>- Novo prompt v2 criado e ativado</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Dia 2, 12:00 - Reflexao #3</span></span>
<span class="line"><span>- Conversas: 15</span></span>
<span class="line"><span>- Score: 4.1 (EXCELENTE)</span></span>
<span class="line"><span>- Acao: NONE</span></span>
<span class="line"><span>- Delta: +0.4 (melhoria confirmada!)</span></span></code></pre></div><hr><h2 id="_5-configuracoes-disponiveis" tabindex="-1">5. Configuracoes Disponiveis <a class="header-anchor" href="#_5-configuracoes-disponiveis" aria-label="Permalink to &quot;5. Configuracoes Disponiveis&quot;">​</a></h2><h3 id="_5-1-configuracoes-de-reflexao" tabindex="-1">5.1 Configuracoes de Reflexao <a class="header-anchor" href="#_5-1-configuracoes-de-reflexao" aria-label="Permalink to &quot;5.1 Configuracoes de Reflexao&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Configuracao</th><th>Default</th><th>Recomendado</th><th>Descricao</th></tr></thead><tbody><tr><td>reflection_enabled</td><td>true</td><td>true</td><td>Habilita o sistema</td></tr><tr><td>reflection_interval_hours</td><td>6</td><td>6-12</td><td>Intervalo entre reflexoes</td></tr><tr><td>min_conversations_for_reflection</td><td>10</td><td>10-20</td><td>Minimo para amostra valida</td></tr></tbody></table><h3 id="_5-2-thresholds-de-decisao" tabindex="-1">5.2 Thresholds de Decisao <a class="header-anchor" href="#_5-2-thresholds-de-decisao" aria-label="Permalink to &quot;5.2 Thresholds de Decisao&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Threshold</th><th>Default</th><th>Ajuste</th><th>Descricao</th></tr></thead><tbody><tr><td>threshold_none</td><td>4.0</td><td>3.8-4.2</td><td>Score para &quot;tudo OK&quot;</td></tr><tr><td>threshold_suggestion</td><td>3.0</td><td>2.8-3.2</td><td>Score para gerar sugestao</td></tr><tr><td>threshold_auto_update</td><td>2.0</td><td>2.0-2.5</td><td>Score para auto-update</td></tr></tbody></table><p><strong>Abaixo de threshold_auto_update = ESCALATE</strong></p><h3 id="_5-3-limites-de-seguranca" tabindex="-1">5.3 Limites de Seguranca <a class="header-anchor" href="#_5-3-limites-de-seguranca" aria-label="Permalink to &quot;5.3 Limites de Seguranca&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Limite</th><th>Default</th><th>Descricao</th></tr></thead><tbody><tr><td>max_updates_per_day</td><td>3</td><td>Maximo de auto-updates por dia</td></tr><tr><td>cooldown_after_update_hours</td><td>6</td><td>Periodo de observacao apos mudanca</td></tr><tr><td>require_approval_below_confidence</td><td>0.8</td><td>Abaixo disso, requer aprovacao humana</td></tr></tbody></table><h3 id="_5-4-configuracoes-de-auto-apply" tabindex="-1">5.4 Configuracoes de Auto-Apply <a class="header-anchor" href="#_5-4-configuracoes-de-auto-apply" aria-label="Permalink to &quot;5.4 Configuracoes de Auto-Apply&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Configuracao</th><th>Default</th><th>CUIDADO</th></tr></thead><tbody><tr><td>auto_apply_enabled</td><td><strong>false</strong></td><td>Habilitar permite mudancas automaticas!</td></tr><tr><td>auto_apply_min_confidence</td><td>0.85</td><td>Minimo 85% de confianca da IA</td></tr><tr><td>auto_apply_max_score_drop</td><td>0.5</td><td>Rollback se score cair mais que 0.5</td></tr></tbody></table><h3 id="_5-5-modelo-avaliador" tabindex="-1">5.5 Modelo Avaliador <a class="header-anchor" href="#_5-5-modelo-avaliador" aria-label="Permalink to &quot;5.5 Modelo Avaliador&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Modelo</th><th>Custo</th><th>Qualidade</th><th>Recomendado</th></tr></thead><tbody><tr><td>claude-sonnet-4-20250514</td><td>Medio</td><td>Alta</td><td><strong>Default</strong></td></tr><tr><td>claude-opus-4-20250514</td><td>Alto</td><td>Muito Alta</td><td>Casos criticos</td></tr><tr><td>gpt-4o</td><td>Medio</td><td>Alta</td><td>Alternativa</td></tr></tbody></table><hr><h2 id="_6-decision-framework" tabindex="-1">6. Decision Framework <a class="header-anchor" href="#_6-decision-framework" aria-label="Permalink to &quot;6. Decision Framework&quot;">​</a></h2><h3 id="_6-1-arvore-de-decisao-detalhada" tabindex="-1">6.1 Arvore de Decisao Detalhada <a class="header-anchor" href="#_6-1-arvore-de-decisao-detalhada" aria-label="Permalink to &quot;6.1 Arvore de Decisao Detalhada&quot;">​</a></h3><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flowchart TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    START([Reflexao Iniciada]) --&gt; SCORE{Overall Score?}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SCORE --&gt;|&quot;&gt;= 4.0&quot;| NONE[&quot;NONE&lt;br/&gt;Manter prompt atual&quot;]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SCORE --&gt;|&quot;3.0 - 3.9&quot;| CHECK_WEAK{Fraquezas&lt;br/&gt;identificadas?}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CHECK_WEAK --&gt;|&quot;Sim&quot;| SUGGESTION[&quot;SUGGESTION&lt;br/&gt;Gerar melhoria&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CHECK_WEAK --&gt;|&quot;Nao&quot;| NONE</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SCORE --&gt;|&quot;2.0 - 2.9&quot;| CHECK_AUTO{Auto-apply&lt;br/&gt;habilitado?}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CHECK_AUTO --&gt;|&quot;Nao&quot;| SUGGESTION</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CHECK_AUTO --&gt;|&quot;Sim&quot;| CHECK_CONF{Confianca&lt;br/&gt;&gt;= 0.85?}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CHECK_CONF --&gt;|&quot;Nao&quot;| SUGGESTION</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CHECK_CONF --&gt;|&quot;Sim&quot;| CHECK_LIMIT{Limite diario&lt;br/&gt;OK?}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CHECK_LIMIT --&gt;|&quot;Nao&quot;| SUGGESTION</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CHECK_LIMIT --&gt;|&quot;Sim&quot;| AUTO[&quot;AUTO_UPDATE&lt;br/&gt;Aplicar mudanca&quot;]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SCORE --&gt;|&quot;&lt; 2.0&quot;| ESCALATE[&quot;ESCALATE&lt;br/&gt;Alerta urgente&quot;]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style NONE fill:#c8e6c9</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style SUGGESTION fill:#fff9c4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style AUTO fill:#ffe0b2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style ESCALATE fill:#ffcdd2</span></span></code></pre></div><h3 id="_6-2-tabela-de-decisao" tabindex="-1">6.2 Tabela de Decisao <a class="header-anchor" href="#_6-2-tabela-de-decisao" aria-label="Permalink to &quot;6.2 Tabela de Decisao&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Score</th><th>Condicao Extra</th><th>Acao</th><th>Notificacao</th></tr></thead><tbody><tr><td>&gt;= 4.0</td><td>-</td><td>NONE</td><td>Nenhuma</td></tr><tr><td>3.5 - 3.9</td><td>Fraquezas menores</td><td>SUGGESTION</td><td>Email/Slack opcional</td></tr><tr><td>3.0 - 3.4</td><td>Fraquezas claras</td><td>SUGGESTION</td><td>WhatsApp CS</td></tr><tr><td>2.5 - 2.9</td><td>Auto-apply OFF</td><td>SUGGESTION</td><td>WhatsApp CS</td></tr><tr><td>2.5 - 2.9</td><td>Auto-apply ON + Conf &gt;= 0.85</td><td>AUTO_UPDATE</td><td>WhatsApp notificacao</td></tr><tr><td>2.0 - 2.4</td><td>Auto-apply ON + Conf &gt;= 0.85</td><td>AUTO_UPDATE</td><td>WhatsApp + Slack</td></tr><tr><td>&lt; 2.0</td><td>-</td><td>ESCALATE</td><td>WhatsApp URGENTE + Slack</td></tr></tbody></table><hr><h2 id="_7-rubrica-de-avaliacao" tabindex="-1">7. Rubrica de Avaliacao <a class="header-anchor" href="#_7-rubrica-de-avaliacao" aria-label="Permalink to &quot;7. Rubrica de Avaliacao&quot;">​</a></h2><h3 id="_7-1-os-5-criterios" tabindex="-1">7.1 Os 5 Criterios <a class="header-anchor" href="#_7-1-os-5-criterios" aria-label="Permalink to &quot;7.1 Os 5 Criterios&quot;">​</a></h3><p>O sistema avalia cada conversa em 5 dimensoes:</p><h4 id="_1-completude-peso-20" tabindex="-1">1. Completude (Peso: 20%) <a class="header-anchor" href="#_1-completude-peso-20" aria-label="Permalink to &quot;1. Completude (Peso: 20%)&quot;">​</a></h4><blockquote><p>O agente respondeu completamente a todas as perguntas e solicitacoes?</p></blockquote><table tabindex="0"><thead><tr><th>Score</th><th>Descricao</th></tr></thead><tbody><tr><td>5.0</td><td>Respondeu 100% das perguntas com detalhes</td></tr><tr><td>4.0</td><td>Respondeu todas, algumas superficialmente</td></tr><tr><td>3.0</td><td>Deixou 1-2 perguntas sem resposta clara</td></tr><tr><td>2.0</td><td>Varias perguntas ignoradas</td></tr><tr><td>1.0</td><td>Falhou em responder a maioria</td></tr></tbody></table><h4 id="_2-profundidade-peso-25" tabindex="-1">2. Profundidade (Peso: 25%) <a class="header-anchor" href="#_2-profundidade-peso-25" aria-label="Permalink to &quot;2. Profundidade (Peso: 25%)&quot;">​</a></h4><blockquote><p>As respostas foram profundas e agregaram valor?</p></blockquote><table tabindex="0"><thead><tr><th>Score</th><th>Descricao</th></tr></thead><tbody><tr><td>5.0</td><td>Respostas excepcionais com insights extras</td></tr><tr><td>4.0</td><td>Respostas completas e uteis</td></tr><tr><td>3.0</td><td>Respostas adequadas, poderiam ser melhores</td></tr><tr><td>2.0</td><td>Respostas superficiais</td></tr><tr><td>1.0</td><td>Respostas minimas ou genericas</td></tr></tbody></table><h4 id="_3-tom-personalidade-peso-15" tabindex="-1">3. Tom/Personalidade (Peso: 15%) <a class="header-anchor" href="#_3-tom-personalidade-peso-15" aria-label="Permalink to &quot;3. Tom/Personalidade (Peso: 15%)&quot;">​</a></h4><blockquote><p>O tom foi consistente com a personalidade configurada?</p></blockquote><table tabindex="0"><thead><tr><th>Score</th><th>Descricao</th></tr></thead><tbody><tr><td>5.0</td><td>Tom perfeito, natural, engajante</td></tr><tr><td>4.0</td><td>Tom adequado, pequenas inconsistencias</td></tr><tr><td>3.0</td><td>Tom OK, mas poderia ser mais natural</td></tr><tr><td>2.0</td><td>Tom inconsistente ou robotico</td></tr><tr><td>1.0</td><td>Tom completamente inadequado</td></tr></tbody></table><h4 id="_4-escopo-relevancia-peso-20" tabindex="-1">4. Escopo/Relevancia (Peso: 20%) <a class="header-anchor" href="#_4-escopo-relevancia-peso-20" aria-label="Permalink to &quot;4. Escopo/Relevancia (Peso: 20%)&quot;">​</a></h4><blockquote><p>As respostas foram relevantes e dentro do escopo?</p></blockquote><table tabindex="0"><thead><tr><th>Score</th><th>Descricao</th></tr></thead><tbody><tr><td>5.0</td><td>100% relevante, sem desvios</td></tr><tr><td>4.0</td><td>Relevante com pequenas tangentes</td></tr><tr><td>3.0</td><td>Algumas respostas fora de contexto</td></tr><tr><td>2.0</td><td>Frequentemente fora do escopo</td></tr><tr><td>1.0</td><td>Respostas irrelevantes</td></tr></tbody></table><h4 id="_5-oportunidades-perdidas-peso-20" tabindex="-1">5. Oportunidades Perdidas (Peso: 20%) <a class="header-anchor" href="#_5-oportunidades-perdidas-peso-20" aria-label="Permalink to &quot;5. Oportunidades Perdidas (Peso: 20%)&quot;">​</a></h4><blockquote><p>O agente aproveitou oportunidades de avanco?</p></blockquote><table tabindex="0"><thead><tr><th>Score</th><th>Descricao</th></tr></thead><tbody><tr><td>5.0</td><td>Aproveitou todas as oportunidades</td></tr><tr><td>4.0</td><td>Aproveitou a maioria</td></tr><tr><td>3.0</td><td>Perdeu algumas oportunidades claras</td></tr><tr><td>2.0</td><td>Perdeu muitas oportunidades</td></tr><tr><td>1.0</td><td>Falhou em identificar qualquer oportunidade</td></tr></tbody></table><h3 id="_7-2-calculo-do-score-final" tabindex="-1">7.2 Calculo do Score Final <a class="header-anchor" href="#_7-2-calculo-do-score-final" aria-label="Permalink to &quot;7.2 Calculo do Score Final&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>overall_score = (</span></span>
<span class="line"><span>    score_completeness * 0.20 +</span></span>
<span class="line"><span>    score_depth * 0.25 +</span></span>
<span class="line"><span>    score_tone * 0.15 +</span></span>
<span class="line"><span>    score_scope * 0.20 +</span></span>
<span class="line"><span>    score_missed_opportunities * 0.20</span></span>
<span class="line"><span>)</span></span></code></pre></div><h3 id="_7-3-classificacao-final" tabindex="-1">7.3 Classificacao Final <a class="header-anchor" href="#_7-3-classificacao-final" aria-label="Permalink to &quot;7.3 Classificacao Final&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Score</th><th>Classificacao</th><th>Cor</th></tr></thead><tbody><tr><td>4.5 - 5.0</td><td>EXCELENTE</td><td>Verde</td></tr><tr><td>4.0 - 4.4</td><td>MUITO BOM</td><td>Verde Claro</td></tr><tr><td>3.5 - 3.9</td><td>BOM</td><td>Amarelo</td></tr><tr><td>3.0 - 3.4</td><td>ADEQUADO</td><td>Laranja</td></tr><tr><td>2.0 - 2.9</td><td>PRECISA ATENCAO</td><td>Vermelho Claro</td></tr><tr><td>&lt; 2.0</td><td>CRITICO</td><td>Vermelho</td></tr></tbody></table><hr><h2 id="_8-integracao-com-n8n" tabindex="-1">8. Integracao com n8n <a class="header-anchor" href="#_8-integracao-com-n8n" aria-label="Permalink to &quot;8. Integracao com n8n&quot;">​</a></h2><h3 id="_8-1-workflows-relacionados" tabindex="-1">8.1 Workflows Relacionados <a class="header-anchor" href="#_8-1-workflows-relacionados" aria-label="Permalink to &quot;8.1 Workflows Relacionados&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Workflow</th><th>Funcao no Sistema</th></tr></thead><tbody><tr><td>05-AI-Agent-Execution-Modular</td><td>Executa agente usando prompt ativo</td></tr><tr><td>08-Boot-Validator</td><td>Valida prompts antes de ativar</td></tr><tr><td>09-QA-Analyst</td><td>Alimenta dados para reflexao</td></tr><tr><td><strong>NOVO: Self-Improving-Loop</strong></td><td>Executa ciclo de reflexao</td></tr></tbody></table><h3 id="_8-2-exemplo-de-workflow-de-reflexao" tabindex="-1">8.2 Exemplo de Workflow de Reflexao <a class="header-anchor" href="#_8-2-exemplo-de-workflow-de-reflexao" aria-label="Permalink to &quot;8.2 Exemplo de Workflow de Reflexao&quot;">​</a></h3><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Node 1: Schedule Trigger</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;rule&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0 */6 * * *&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // A cada 6 horas</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Node 2: Buscar Agentes Ativos</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;operation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;select&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;table&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;agent_versions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;filters&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;is_active&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;active&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Node 3: Loop para cada agente</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Para cada agente...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Node 4: Verificar se pode rodar</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;operation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;rpc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;function&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;can_run_reflection&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;p_agent_version_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{{ $json.id }}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Node 5: Buscar Conversas do Periodo</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;operation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;select&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;table&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;agent_conversations&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;filters&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;agent_version_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{{ $json.id }}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;started_at&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;gte&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{{ $now.minus({hours: 6}).toISO() }}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Node 6: Avaliar com Claude</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;model&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;claude-sonnet-4-20250514&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;system&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Voce e um avaliador de qualidade...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Avalie estas conversas usando a rubrica...&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Node 7: Decision Framework</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// (Switch baseado no score)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Node 8-11: Acoes conforme decisao</span></span></code></pre></div><h3 id="_8-3-queries-supabase-uteis" tabindex="-1">8.3 Queries Supabase Uteis <a class="header-anchor" href="#_8-3-queries-supabase-uteis" aria-label="Permalink to &quot;8.3 Queries Supabase Uteis&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- Buscar prompt ativo de um agente</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> system_prompts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> agent_version_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;uuid&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> is_active </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> true;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- Historico de reflexoes</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> reflection_logs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> agent_version_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;uuid&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ORDER BY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> created_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DESC</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> LIMIT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- Sugestoes pendentes</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vw_pending_suggestions</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> agent_version_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;uuid&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- Evolucao de scores (ultimos 7 dias)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vw_score_evolution</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> agent_version_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;uuid&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> date</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CURRENT_DATE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> INTERVAL </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;7 days&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><hr><h2 id="_9-seguranca-e-guardrails" tabindex="-1">9. Seguranca e Guardrails <a class="header-anchor" href="#_9-seguranca-e-guardrails" aria-label="Permalink to &quot;9. Seguranca e Guardrails&quot;">​</a></h2><h3 id="_9-1-guardrails-de-seguranca" tabindex="-1">9.1 Guardrails de Seguranca <a class="header-anchor" href="#_9-1-guardrails-de-seguranca" aria-label="Permalink to &quot;9.1 Guardrails de Seguranca&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Guardrail</th><th>Descricao</th><th>Configuravel</th></tr></thead><tbody><tr><td><strong>Cooldown</strong></td><td>Minimo 6h entre reflexoes</td><td>Sim</td></tr><tr><td><strong>Limite Diario</strong></td><td>Maximo 3 auto-updates/dia</td><td>Sim</td></tr><tr><td><strong>Confianca Minima</strong></td><td>Auto-apply so com &gt;= 85%</td><td>Sim</td></tr><tr><td><strong>Rollback Automatico</strong></td><td>Se score cair &gt; 0.5</td><td>Sim</td></tr><tr><td><strong>Aprovacao Humana</strong></td><td>Default para sugestoes</td><td>Sim</td></tr><tr><td><strong>Escalacao</strong></td><td>Score &lt; 2.0 = humano</td><td>Nao</td></tr></tbody></table><h3 id="_9-2-triggers-de-bloqueio" tabindex="-1">9.2 Triggers de Bloqueio <a class="header-anchor" href="#_9-2-triggers-de-bloqueio" aria-label="Permalink to &quot;9.2 Triggers de Bloqueio&quot;">​</a></h3><p>O sistema bloqueia auto-updates quando:</p><ol><li><strong>Limite diario atingido</strong>: &gt;= 3 updates hoje</li><li><strong>Score caiu muito</strong>: Delta &lt; -0.5 no ultimo update</li><li><strong>Escalacao recente</strong>: Houve escalate nas ultimas 24h</li><li><strong>Rollback recente</strong>: Houve rollback nas ultimas 48h</li><li><strong>Manual override</strong>: Admin desabilitou temporariamente</li></ol><h3 id="_9-3-rollback-automatico" tabindex="-1">9.3 Rollback Automatico <a class="header-anchor" href="#_9-3-rollback-automatico" aria-label="Permalink to &quot;9.3 Rollback Automatico&quot;">​</a></h3><p>Quando um auto-update e aplicado:</p><ol><li>Sistema marca previous_prompt_id</li><li>Inicia periodo de observacao (24h)</li><li>Apos 24h, compara scores: <ul><li>Se new_score &gt;= old_score - 0.5: Mantem</li><li>Se new_score &lt; old_score - 0.5: Rollback</li></ul></li><li>Rollback: <ul><li>Desativa prompt novo</li><li>Reativa prompt anterior</li><li>Cria log com change_reason = &#39;rollback&#39;</li><li>Notifica equipe</li></ul></li></ol><h3 id="_9-4-auditoria-completa" tabindex="-1">9.4 Auditoria Completa <a class="header-anchor" href="#_9-4-auditoria-completa" aria-label="Permalink to &quot;9.4 Auditoria Completa&quot;">​</a></h3><p>Toda acao e logada:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- Ver historico completo de mudancas</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  sp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  sp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">change_reason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  sp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">performance_score</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  sp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">created_at</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  sp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">activated_at</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  sp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">deactivated_at</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> system_prompts sp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> agent_version_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;uuid&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ORDER BY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> version</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DESC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><hr><h2 id="_10-troubleshooting" tabindex="-1">10. Troubleshooting <a class="header-anchor" href="#_10-troubleshooting" aria-label="Permalink to &quot;10. Troubleshooting&quot;">​</a></h2><h3 id="_10-1-problemas-comuns" tabindex="-1">10.1 Problemas Comuns <a class="header-anchor" href="#_10-1-problemas-comuns" aria-label="Permalink to &quot;10.1 Problemas Comuns&quot;">​</a></h3><h4 id="reflexao-nao-esta-rodando" tabindex="-1">Reflexao nao esta rodando <a class="header-anchor" href="#reflexao-nao-esta-rodando" aria-label="Permalink to &quot;Reflexao nao esta rodando&quot;">​</a></h4><p><strong>Sintoma:</strong> Nenhum log em reflection_logs</p><p><strong>Verificar:</strong></p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> can_run_reflection(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;agent-uuid&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p><strong>Causas possiveis:</strong></p><ul><li>reflection_enabled = false</li><li>Cooldown nao respeitado</li><li>Menos conversas que o minimo</li></ul><h4 id="score-sempre-muito-baixo" tabindex="-1">Score sempre muito baixo <a class="header-anchor" href="#score-sempre-muito-baixo" aria-label="Permalink to &quot;Score sempre muito baixo&quot;">​</a></h4><p><strong>Sintoma:</strong> Scores consistentemente &lt; 3.0</p><p><strong>Verificar:</strong></p><ul><li>Prompt base esta adequado?</li><li>Rubrica esta alinhada com objetivos?</li><li>Conversas de teste estao representativas?</li></ul><p><strong>Solucao:</strong></p><ol><li>Revisar prompt manualmente</li><li>Ajustar rubrica se necessario</li><li>Aumentar min_conversations_for_reflection</li></ol><h4 id="auto-update-esta-gerando-prompts-ruins" tabindex="-1">Auto-update esta gerando prompts ruins <a class="header-anchor" href="#auto-update-esta-gerando-prompts-ruins" aria-label="Permalink to &quot;Auto-update esta gerando prompts ruins&quot;">​</a></h4><p><strong>Sintoma:</strong> Scores caindo apos auto-updates</p><p><strong>Solucao imediata:</strong></p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">UPDATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> self_improving_settings</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> auto_apply_enabled </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> false</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> agent_version_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;uuid&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p><strong>Solucao definitiva:</strong></p><ol><li>Revisar sugestoes rejeitadas</li><li>Ajustar auto_apply_min_confidence para 0.9</li><li>Reduzir max_updates_per_day para 1</li></ol><h4 id="muitas-notificacoes" tabindex="-1">Muitas notificacoes <a class="header-anchor" href="#muitas-notificacoes" aria-label="Permalink to &quot;Muitas notificacoes&quot;">​</a></h4><p><strong>Sintoma:</strong> Spam de alertas</p><p><strong>Solucao:</strong></p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">UPDATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> self_improving_settings</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SET</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  notify_on_suggestion </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> false,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  notify_on_auto_update </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> true,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  notify_on_escalation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> agent_version_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;uuid&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h3 id="_10-2-queries-de-diagnostico" tabindex="-1">10.2 Queries de Diagnostico <a class="header-anchor" href="#_10-2-queries-de-diagnostico" aria-label="Permalink to &quot;10.2 Queries de Diagnostico&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- Status geral do sistema</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vw_self_improving_summary;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- Ultimas 10 reflexoes</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  created_at,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  overall_score,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  action_taken,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  weaknesses</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> reflection_logs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ORDER BY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> created_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DESC</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LIMIT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- Sugestoes rejeitadas (para analise)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  rationale,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  suggested_value,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  review_notes</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> improvement_suggestions</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;rejected&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ORDER BY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> created_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DESC</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LIMIT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- Rollbacks (indicam problema)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> system_prompts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> change_reason </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;rollback&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ORDER BY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> created_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DESC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h3 id="_10-3-reset-do-sistema" tabindex="-1">10.3 Reset do Sistema <a class="header-anchor" href="#_10-3-reset-do-sistema" aria-label="Permalink to &quot;10.3 Reset do Sistema&quot;">​</a></h3><p>Se precisar resetar completamente:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- CUIDADO: Isso apaga todo o historico!</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 1. Desativar sistema</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">UPDATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> self_improving_settings</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> reflection_enabled </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> false, auto_apply_enabled </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> false</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> agent_version_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;uuid&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 2. Limpar sugestoes pendentes</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DELETE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> improvement_suggestions</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> agent_version_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;uuid&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> AND</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;pending&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 3. Manter apenas prompt ativo</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DELETE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> system_prompts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> agent_version_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;uuid&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> is_active </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> false;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 4. Reativar</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">UPDATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> self_improving_settings</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> reflection_enabled </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> agent_version_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;uuid&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><hr><h2 id="apendice-a-prompt-do-avaliador" tabindex="-1">Apendice A: Prompt do Avaliador <a class="header-anchor" href="#apendice-a-prompt-do-avaliador" aria-label="Permalink to &quot;Apendice A: Prompt do Avaliador&quot;">​</a></h2><div class="language-markdown vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">markdown</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Voce e um avaliador de qualidade de agentes de IA conversacionais.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Avalie as conversas abaixo usando a seguinte rubrica:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">## RUBRICA DE AVALIACAO</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">### 1. Completude (0-5)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">O agente respondeu completamente todas as perguntas?</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">### 2. Profundidade (0-5)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">As respostas agregaram valor real?</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">### 3. Tom/Personalidade (0-5)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">O tom foi consistente e adequado?</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">### 4. Escopo/Relevancia (0-5)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">As respostas foram relevantes?</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">### 5. Oportunidades Perdidas (0-5)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">O agente aproveitou oportunidades de avanco?</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">## OUTPUT ESPERADO</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Retorne JSON:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &quot;scores&quot;: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &quot;completeness&quot;: 4.2,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &quot;depth&quot;: 3.8,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &quot;tone&quot;: 4.5,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &quot;scope&quot;: 4.0,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &quot;missed_opportunities&quot;: 3.5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &quot;overall_score&quot;: 4.0,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &quot;strengths&quot;: [&quot;...&quot;, &quot;...&quot;],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &quot;weaknesses&quot;: [&quot;...&quot;, &quot;...&quot;],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &quot;patterns&quot;: [&quot;...&quot;, &quot;...&quot;],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &quot;improvement_suggestion&quot;: &quot;Se score &lt; 4: sugestao de melhoria&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="apendice-b-checklist-de-implementacao" tabindex="-1">Apendice B: Checklist de Implementacao <a class="header-anchor" href="#apendice-b-checklist-de-implementacao" aria-label="Permalink to &quot;Apendice B: Checklist de Implementacao&quot;">​</a></h2><ul><li>[ ] Executar migration 001_self_improving_system.sql</li><li>[ ] Verificar tabelas criadas</li><li>[ ] Configurar settings para agentes existentes</li><li>[ ] Criar workflow de reflexao no n8n</li><li>[ ] Testar com 1 agente em modo suggestion-only</li><li>[ ] Monitorar por 1 semana</li><li>[ ] Habilitar auto-apply gradualmente</li><li>[ ] Configurar alertas e dashboards</li></ul><hr><p><strong>Mantenedor:</strong> AI Factory Team <strong>Versao do Documento:</strong> 1.0 <strong>Data:</strong> 2025-12-27</p>`,170)])])}const E=a(e,[["render",l]]);export{c as __pageData,E as default};
